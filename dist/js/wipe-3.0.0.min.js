/*!lj-wipe 3.0.0 发布日期:18y-11-27*/
function Wipe(t){this.conID=t.id,this.cas=document.getElementById(this.conID),this.context=cas.getContext("2d"),this._w=t.width,this._h=t.height,this.coverType=t.coverType,this.color=t.color||"#666",this.imgUrl=t.imgUrl,this.backImgUrl=t.backImgUrl,this.radius=t.radius,this.posX=0,this.posY=0,this.isMouseDown=!1,this.callback=t.callback,this.transpercent=t.transpercent,this.drawMask(),this.addEvent()}Wipe.prototype.drawMask=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("image"===this.coverType){var t=new Image,e=this;t.src=this.imgUrl,t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.drawT=function(t,e,i,o){if(3===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.lineWidth=2*this.radius,this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4){0===e.data[i+3]&&t++}return this.percent=t/(this._w*this._h)*100,console.log("透明点的个数："+t),console.log("占总面积"+Math.ceil(this.percent)+"%"),this.percent.toFixed(2)},Wipe.prototype.addEvent=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());for(var s,n,t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",i=this.device?"touchend":"mouseup",c=this.cas.offsetTop,h=this.cas.offsetLeft,o=this.cas;o=o.offsetParent;)c+=o.offsetTop,h+=o.offsetLeft;var r=this;this.cas.addEventListener(t,function(t){r.isMouseDown=!0;var e=t||window.event;s=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft,r.posX=r.device?e.touches[0].clientX-h+n:e.clientX-h+n,r.posY=r.device?e.touches[0].clientY-c+s:e.clientY-c+s,r.drawT(r.posX,r.posY)},!1),this.cas.addEventListener(e,function(t){if(!r.isMouseDown)return!1;var e=t||window.event;e.preventDefault();var i=r.device?e.touches[0].clientX-h+n:e.clientX-h+n,o=r.device?e.touches[0].clientY-c+s:e.clientY-c+s;r.drawT(r.posX,r.posY,i,o),r.posX=i,r.posY=o},!1),this.cas.addEventListener(i,function(){r.isMouseDown=!1,console.log(r.transpercent);var t=r.getTransparencyPercent();r.callback.call(null,t),t>r.transpercent&&r.clearRect()},!1)};